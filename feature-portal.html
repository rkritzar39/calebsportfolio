<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Community Portal â€“ Caleb</title>
  <link rel="stylesheet" href="portal.css" />
</head>
<body>
  <div id="feature-portal" class="portal-wrapper">
    <!-- Header -->
    <header class="portal-header glass">
      <div class="header-row">
        <h1>ğŸ§  Community Portal</h1>
        <a class="home-link" href="/">â† Back to Home</a>
      </div>
      <p>Submit ideas, browse requests, see the roadmap & status, and contact me.</p>
    </header>

    <!-- Tabs -->
    <nav class="portal-tabs glass" aria-label="Sections">
      <button class="tab-btn active" data-tab="submit">ğŸ“ Submit</button>
      <button class="tab-btn" data-tab="requests">ğŸ“‹ Requests</button>
      <button class="tab-btn" data-tab="changelog">ğŸ§¾ Changelog</button>
      <button class="tab-btn" data-tab="roadmap">ğŸ—ºï¸ Roadmap</button>
      <button class="tab-btn" data-tab="kb">ğŸ§  Knowledge Base</button>
      <button class="tab-btn" data-tab="stats">ğŸ“Š Stats</button>
      <button class="tab-btn" data-tab="status">âš™ï¸ Status</button>
      <button class="tab-btn" data-tab="contact">âœ‰ï¸ Contact</button>
      <button class="tab-btn" data-tab="about">ğŸªª About</button>
      <button class="tab-btn" data-tab="privacy">ğŸ” Privacy</button>
    </nav>

    <!-- SUBMIT -->
    <section id="tab-submit" class="tab-content active glass" role="region" aria-labelledby="submit">
      <h2 id="submit">Submit a Request</h2>
      <form id="request-form" class="portal-form" novalidate>
        <label>
          <span>Title</span>
          <input id="req-title" type="text" placeholder="Summarize your ideaâ€¦" maxlength="60" required />
          <small class="hint">Max 60 characters</small>
        </label>

        <div class="row-2">
          <label>
            <span>Category</span>
            <select id="req-category">
              <option>Feature</option>
              <option>Bug</option>
              <option>Feedback</option>
            </select>
          </label>
          <label>
            <span>Priority</span>
            <select id="req-priority">
              <option>Normal</option>
              <option>High</option>
              <option>Low</option>
            </select>
          </label>
        </div>

        <label>
          <span>Description</span>
          <textarea id="req-desc" rows="4" placeholder="Explain the idea or issueâ€¦" maxlength="500" required></textarea>
          <small class="hint">Max 500 characters</small>
        </label>

        <div class="row-2">
          <label>
            <span>Name (optional)</span>
            <input id="req-name" type="text" placeholder="Your name or handle" maxlength="30" />
          </label>
          <label>
            <span>Email (optional)</span>
            <input id="req-email" type="email" placeholder="you@example.com" />
          </label>
        </div>

        <label class="checkbox">
          <input id="req-consent" type="checkbox" />
          <span>Allow follow-up if I have questions</span>
        </label>

        <button type="submit" class="onyx-btn">ğŸš€ Submit</button>
        <p id="req-status" class="req-status" role="status" aria-live="polite"></p>
      </form>
    </section>

    <!-- REQUESTS -->
    <section id="tab-requests" class="tab-content glass" role="region" aria-labelledby="requests">
      <div class="requests-topbar">
        <h2 id="requests">All Requests</h2>

        <div class="controls">
          <div class="search-bar glass">
            <svg class="search-icon" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M15.5 14h-.79l-.28-.27a6.47 6.47 0 0 0 1.57-4.23A6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79L20 21.5 21.5 20 15.5 14Zm-6 0A4.5 4.5 0 1 1 14 9.5 4.5 4.5 0 0 1 9.5 14Z"/></svg>
            <input id="search" type="text" placeholder="Search requestsâ€¦" aria-label="Search requests" />
          </div>

          <label class="sort">
            <span>Sort</span>
            <select id="sort-select" aria-label="Sort requests">
              <option value="newest">Newest</option>
              <option value="oldest">Oldest</option>
              <option value="status">Status</option>
              <option value="category">Category</option>
              <option value="priority">Priority</option>
            </select>
          </label>
        </div>
      </div>

      <!-- Filter chips -->
      <div class="chip-row">
        <div class="chip-group" role="group" aria-label="Category filter">
          <button class="chip active" data-cat="all">All</button>
          <button class="chip" data-cat="Feature">Feature</button>
          <button class="chip" data-cat="Bug">Bug</button>
          <button class="chip" data-cat="Feedback">Feedback</button>
        </div>
        <div class="chip-group" role="group" aria-label="Status filter">
          <button class="chip active" data-status="all">All</button>
          <button class="chip" data-status="pending">Pending</button>
          <button class="chip" data-status="approved">Approved</button>
          <button class="chip" data-status="in_progress">In Progress</button>
          <button class="chip" data-status="completed">Completed</button>
          <button class="chip" data-status="rejected">Rejected</button>
        </div>
      </div>

      <!-- Stats summary -->
      <div class="stats-inline" id="stats-inline"></div>

      <!-- List -->
      <div id="request-list" class="request-list" aria-live="polite"></div>

      <!-- Pagination -->
      <div class="pagination">
        <button id="load-more" class="ghost-btn">Load more</button>
      </div>
    </section>

    <!-- CHANGELOG -->
    <section id="tab-changelog" class="tab-content glass" role="region" aria-labelledby="changelog">
      <h2 id="changelog">Changelog</h2>
      <ul class="changelog-list" id="changelog-list">
        <li><strong>Nov 5, 2025:</strong> Portal preview with filters, sorting, stats, roadmap, status and contact.</li>
        <li><strong>Nov 3, 2025:</strong> Compact mode & layout improvements.</li>
        <li><strong>Oct 30, 2025:</strong> Blur control & reduced motion options.</li>
      </ul>
    </section>

    <!-- ROADMAP -->
    <section id="tab-roadmap" class="tab-content glass" role="region" aria-labelledby="roadmap">
      <h2 id="roadmap">Public Roadmap</h2>
      <div class="roadmap-grid">
        <div class="roadmap-column">
          <h3>ğŸ§  Planned</h3>
          <div class="roadmap-card">â€œExport Settings JSONâ€ <small>#REQ-106</small></div>
          <div class="roadmap-card">â€œImproved Mobile Spacingâ€ <small>#REQ-113</small></div>
          <div class="roadmap-card">â€œStatus Filter Buttonsâ€ <small>#REQ-118</small></div>
        </div>
        <div class="roadmap-column">
          <h3>âš™ï¸ In Progress</h3>
          <div class="roadmap-card">â€œMusic Visualizer Integrationâ€ <small>#REQ-102</small></div>
          <div class="roadmap-card">â€œStats Overview Bannerâ€ <small>#REQ-109</small></div>
        </div>
        <div class="roadmap-column">
          <h3>âœ… Completed</h3>
          <div class="roadmap-card done">â€œDark Mode Flicker Fixâ€ <small>#BUG-091</small></div>
          <div class="roadmap-card done">â€œContact Auto-Replyâ€ <small>#REQ-095</small></div>
        </div>
      </div>
      <p class="muted mt">Roadmap items are examples for preview. Final items can sync from request statuses later.</p>
    </section>

    <!-- KNOWLEDGE BASE -->
    <section id="tab-kb" class="tab-content glass" role="region" aria-labelledby="kb">
      <h2 id="kb">Knowledge Base</h2>
      <div class="kb-list">
        <details open>
          <summary>How do I submit a great feature request?</summary>
          <p>Include a short title, clear description, why it helps, and any examples. One idea per request is best.</p>
        </details>
        <details>
          <summary>What do the statuses mean?</summary>
          <ul>
            <li><strong>Pending</strong> â€” waiting for review</li>
            <li><strong>Approved</strong> â€” accepted for the roadmap</li>
            <li><strong>In Progress</strong> â€” actively being built</li>
            <li><strong>Completed</strong> â€” shipped!</li>
            <li><strong>Rejected</strong> â€” not a fit right now (may include a reason)</li>
          </ul>
        </details>
        <details>
          <summary>Why was my request rejected?</summary>
          <p>Usually overlap with another request, technical constraints, or not aligned with current goals.</p>
        </details>
        <details>
          <summary>Do I need to log in?</summary>
          <p>No. Submissions are open. You may optionally include an email for follow-up.</p>
        </details>
      </div>
    </section>

    <!-- STATS -->
    <section id="tab-stats" class="tab-content glass" role="region" aria-labelledby="stats">
      <h2 id="stats">Portal Stats</h2>
      <div class="stats-grid" id="stats-grid"></div>
    </section>

    <!-- STATUS (improved dashboard style) -->
    <section id="tab-status" class="tab-content glass" role="region" aria-labelledby="status">
      <h2 id="status">System Status</h2>

      <div class="status-summary">
        <div class="status-dot ok"></div>
        <div class="summary-text">
          <h3>All Systems Operational</h3>
          <p>Last updated: <span id="status-updated">Nov 5 2025 10:42 AM</span></p>
        </div>
      </div>

      <div class="status-services">
        <details open>
          <summary>
            <span class="service-name">ğŸŒ Website</span>
            <span class="badge ok">Operational</span>
          </summary>
          <p>No known issues.</p>
        </details>

        <details open>
          <summary>
            <span class="service-name">ğŸ—„ï¸ Database (Firebase)</span>
            <span class="badge ok">Operational</span>
          </summary>
          <p>Read/write latency &lt; 120 ms. Automatic scaling active.</p>
        </details>

        <details open>
          <summary>
            <span class="service-name">ğŸ§ Live Activity</span>
            <span class="badge warn">Degraded Performance</span>
          </summary>
          <p>Spotify API occasionally rate-limits updates. Monitoring in progress.</p>
        </details>

        <details>
          <summary>
            <span class="service-name">ğŸ“¹ TikTok Integration</span>
            <span class="badge down">Partial Outage</span>
          </summary>
          <p>Some video thumbnails failing to load. Awaiting API stability fix.</p>
        </details>

        <details>
          <summary>
            <span class="service-name">ğŸ’¬ Discord Status</span>
            <span class="badge down">Outage</span>
          </summary>
          <p>Discord presence API unreachable. Automatic retry every 10 minutes.</p>
        </details>
      </div>

      <div class="uptime-graph">
        <h4>Past 7 Days Uptime</h4>
        <div class="bars">
          <div class="bar ok"   title="100%"></div>
          <div class="bar ok"   title="100%"></div>
          <div class="bar ok"   title="100%"></div>
          <div class="bar warn" title="97%"></div>
          <div class="bar ok"   title="100%"></div>
          <div class="bar ok"   title="100%"></div>
          <div class="bar ok"   title="100%"></div>
        </div>
        <p class="muted small">Each bar represents one day. Hover for uptime %.</p>
      </div>

      <footer class="status-footer">
        <p>Next automatic check in: <strong>10 minutes</strong></p>
        <p class="muted small">Status data is updated manually for this preview.</p>
      </footer>
    </section>

    <!-- CONTACT -->
    <section id="tab-contact" class="tab-content glass" role="region" aria-labelledby="contact">
      <h2 id="contact">Contact</h2>
      <p>Have a question or something private? Send a message here.</p>
      <form id="contact-form" class="portal-form" novalidate>
        <label>
          <span>Name</span>
          <input id="contact-name" type="text" placeholder="Your name" maxlength="40" />
        </label>
        <label>
          <span>Email</span>
          <input id="contact-email" type="email" placeholder="you@example.com" required />
        </label>
        <label>
          <span>Subject</span>
          <select id="contact-subject">
            <option>Support</option>
            <option>Business</option>
            <option>Other</option>
          </select>
        </label>
        <label>
          <span>Message</span>
          <textarea id="contact-message" rows="4" placeholder="Write your messageâ€¦" maxlength="1000" required></textarea>
        </label>
        <button type="submit" class="onyx-btn">ğŸ“¨ Send</button>
        <p id="contact-status" class="req-status" role="status" aria-live="polite"></p>
      </form>
    </section>

    <!-- ABOUT -->
    <section id="tab-about" class="tab-content glass" role="region" aria-labelledby="about">
      <h2 id="about">About This Portal</h2>
      <div class="about-grid">
        <div class="about-card">
          <h3>Mission</h3>
          <p>Make feedback simple, transparent, and useful â€” so the site keeps getting better.</p>
        </div>
        <div class="about-card">
          <h3>Stack</h3>
          <p>HTML, CSS, JS (Onyx UI). Planned: Firebase Auth + Firestore for storage.</p>
        </div>
        <div class="about-card">
          <h3>Version</h3>
          <p>Preview 1.0 â€” Nov 2025</p>
        </div>
      </div>
      <p class="muted mt">Questions or ideas? Use the Contact tab or submit a request.</p>
    </section>

    <!-- PRIVACY -->
    <section id="tab-privacy" class="tab-content glass" role="region" aria-labelledby="privacy">
      <h2 id="privacy">Privacy & Policy</h2>
      <ul class="policy-list">
        <li><strong>What we collect:</strong> Feature requests (public) and contact messages (private).</li>
        <li><strong>How itâ€™s used:</strong> To improve the site and respond to messages.</li>
        <li><strong>Retention:</strong> Requests remain visible; contact messages are stored privately.</li>
        <li><strong>Deletion:</strong> To request removal of a message, contact me via the Contact tab.</li>
      </ul>
      <p class="muted mt">This is a simple, human-readable summary. A full policy page can be linked here later.</p>
    </section>
  </div>

  <!-- Request Details Modal -->
  <dialog id="details-modal" class="glass">
    <div class="modal-header">
      <h3 id="modal-title">Request</h3>
      <button id="modal-close" class="icon-btn" aria-label="Close">âœ•</button>
    </div>
    <div id="modal-body" class="modal-body"></div>
    <div class="modal-footer">
      <button id="modal-close-2" class="ghost-btn">Close</button>
    </div>
  </dialog>

  <script>
    /* ===========================
       Mock data (preview only)
       =========================== */
    const MOCK = [
      {title:"Custom Background Uploads",category:"Feature",priority:"Normal",desc:"Allow users to upload wallpapers.",status:"approved",reason:"",date:"2025-11-02"},
      {title:"Music Visualizer Integration",category:"Feature",priority:"High",desc:"Reactive waveform behind live activity.",status:"in_progress",reason:"",date:"2025-11-01"},
      {title:"Dark Mode Flicker Fix",category:"Bug",priority:"High",desc:"Eliminate flicker toggling themes.",status:"completed",reason:"",date:"2025-10-30"},
      {title:"Auto Play Music on Load",category:"Feature",priority:"Low",desc:"Start playing on page load.",status:"rejected",reason:"Browser autoplay policies.",date:"2025-10-29"},
      {title:"Improve Mobile Spacing",category:"Feedback",priority:"Normal",desc:"Cards feel tight on small screens.",status:"pending",reason:"",date:"2025-11-05"},
      {title:"Export Settings JSON",category:"Feature",priority:"Normal",desc:"Download all settings as JSON.",status:"approved",reason:"",date:"2025-10-28"},
      {title:"Search Debounce",category:"Feature",priority:"Low",desc:"Debounce search for performance.",status:"pending",reason:"",date:"2025-11-04"},
      {title:"Contact Auto-Reply",category:"Feature",priority:"Low",desc:"Show confirmation after sending.",status:"completed",reason:"",date:"2025-10-27"},
      {title:"Accessibility Labels",category:"Bug",priority:"High",desc:"Add aria-labels for controls.",status:"approved",reason:"",date:"2025-11-03"},
      {title:"Stats Overview Banner",category:"Feature",priority:"Normal",desc:"Show counts for statuses.",status:"in_progress",reason:"",date:"2025-10-31"},
      {title:"Prevent Duplicate Requests",category:"Feature",priority:"High",desc:"Warn if similar title exists.",status:"pending",reason:"",date:"2025-11-05"}
    ];

    /* ===========================
       State & utilities
       =========================== */
    let state = { query:"", cat:"all", status:"all", sort:"newest", page:1, pageSize:6 };

    const $  = (sel, ctx=document) => ctx.querySelector(sel);
    const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));
    const fmtDate = iso => new Date(iso+"T00:00:00").toLocaleDateString(undefined,{month:"short",day:"numeric",year:"numeric"});

    const sortFn = (a,b)=>{
      if(state.sort==="newest") return b.date.localeCompare(a.date);
      if(state.sort==="oldest") return a.date.localeCompare(b.date);
      if(state.sort==="status") return a.status.localeCompare(b.status);
      if(state.sort==="category") return a.category.localeCompare(b.category);
      if(state.sort==="priority"){const o={High:0,Normal:1,Low:2};return o[a.priority]-o[b.priority];}
      return 0;
    };
    const statusLabel = s=>({approved:"âœ… Approved",in_progress:"âš™ï¸ In Progress",completed:"âœ… Completed",rejected:"âŒ Rejected",pending:"â€¢ Pending"}[s]||s);

    function filtered(){
      const q = state.query.toLowerCase();
      return MOCK
        .filter(r=>!q || (r.title+" "+r.desc+" "+r.category+" "+r.status+" "+r.priority).toLowerCase().includes(q))
        .filter(r=>state.cat==="all"||r.category===state.cat)
        .filter(r=>state.status==="all"||r.status===state.status)
        .sort(sortFn);
    }

    /* ===========================
       Renderers
       =========================== */
    function renderStatsInline(list){
      const count = s=>list.filter(x=>x.status===s).length;
      $("#stats-inline").innerHTML = `
        <div class="pill">Total: <strong>${list.length}</strong></div>
        <div class="pill">Approved: <strong>${count("approved")}</strong></div>
        <div class="pill">In Progress: <strong>${count("in_progress")}</strong></div>
        <div class="pill">Completed: <strong>${count("completed")}</strong></div>
        <div class="pill">Rejected: <strong>${count("rejected")}</strong></div>
        <div class="pill">Pending: <strong>${count("pending")}</strong></div>`;
    }

    function renderStatsGrid(){
      const list = MOCK, by=(k,v)=>list.filter(x=>x[k]===v).length;
      $("#stats-grid").innerHTML = `
        <div class="stat"><h3>${list.length}</h3><p>Total Requests</p></div>
        <div class="stat"><h3>${by("status","approved")}</h3><p>Approved</p></div>
        <div class="stat"><h3>${by("status","in_progress")}</h3><p>In Progress</p></div>
        <div class="stat"><h3>${by("status","completed")}</h3><p>Completed</p></div>
        <div class="stat"><h3>${by("status","rejected")}</h3><p>Rejected</p></div>
        <div class="stat"><h3>${by("status","pending")}</h3><p>Pending</p></div>`;
    }

    function cardHTML(r,i){
      const cls = `request-card ${r.status==="rejected"?"rejected":""}`;
      const st  = `status ${r.status.replace("_","-")}`;
      return `
        <article class="${cls}" data-idx="${i}" tabindex="0" role="button" aria-label="Open request details: ${r.title}">
          <h3>${r.title}</h3>
          <p>${r.desc}</p>
          <div class="meta">
            <span class="badge">${r.category}</span>
            <span class="badge ${r.priority.toLowerCase()}">${r.priority}</span>
            <span class="${st}">${statusLabel(r.status)}</span>
            <span class="date">Submitted: ${fmtDate(r.date)}</span>
          </div>
          ${r.reason?`<small class="reason">Reason: ${r.reason}</small>`:""}
        </article>`;
    }

    function renderList(){
      const all = filtered();
      renderStatsInline(all);
      const end = state.page*state.pageSize;
      const items = all.slice(0,end);
      $("#request-list").innerHTML = items.map((r,i)=>cardHTML(r,i)).join("") || `<p class="muted">No matching requests.</p>`;
      $("#load-more").style.display = end < all.length ? "inline-flex" : "none";
    }

    /* ===========================
       Modal
       =========================== */
    const modal = $("#details-modal");
    const openModal = r=>{
      $("#modal-title").textContent = r.title;
      $("#modal-body").innerHTML = `
        <div class="kv"><span>Category</span><strong>${r.category}</strong></div>
        <div class="kv"><span>Priority</span><strong>${r.priority}</strong></div>
        <div class="kv"><span>Status</span><strong>${statusLabel(r.status)}</strong></div>
        <div class="kv"><span>Date</span><strong>${fmtDate(r.date)}</strong></div>
        <p class="mt">${r.desc}</p>
        ${r.reason?`<p class="muted">Reject reason: ${r.reason}</p>`:""}`;
      modal.showModal();
    };
    $("#modal-close").onclick = $("#modal-close-2").onclick = ()=>modal.close();
    modal.addEventListener("click",(e)=>{
      const r = modal.getBoundingClientRect();
      if (e.clientX<r.left||e.clientX>r.right||e.clientY<r.top||e.clientY>r.bottom) modal.close();
    });

    /* ===========================
       Wire up interactions
       =========================== */
    // Tabs
    $$(".tab-btn").forEach(btn=>{
      btn.addEventListener("click",()=>{
        $$(".tab-btn").forEach(b=>b.classList.remove("active"));
        $$(".tab-content").forEach(c=>c.classList.remove("active"));
        btn.classList.add("active");
        $("#tab-"+btn.dataset.tab).classList.add("active");
        window.scrollTo({top:0,behavior:"smooth"});
      });
    });

    // Search & sort
    $("#search").addEventListener("input",e=>{state.query=e.target.value.trim();state.page=1;renderList();});
    $("#sort-select").addEventListener("change",e=>{state.sort=e.target.value;state.page=1;renderList();});

    // Filters
    $$("[data-cat]").forEach(ch=>{
      ch.addEventListener("click",()=>{
        $$("[data-cat]").forEach(x=>x.classList.remove("active"));
        ch.classList.add("active");
        state.cat = ch.dataset.cat;
        state.page = 1;
        renderList();
      });
    });
    $$("[data-status]").forEach(ch=>{
      ch.addEventListener("click",()=>{
        $$("[data-status]").forEach(x=>x.classList.remove("active"));
        ch.classList.add("active");
        state.status = ch.dataset.status;
        state.page = 1;
        renderList();
      });
    });

    // Pagination
    $("#load-more").addEventListener("click",()=>{ state.page++; renderList(); });

    // Card open (mouse + keyboard)
    $("#request-list").addEventListener("click",e=>{
      const card = e.target.closest(".request-card"); if(!card) return;
      const idx = +card.dataset.idx; const item = filtered()[idx];
      if(item) openModal(item);
    });
    $("#request-list").addEventListener("keydown",e=>{
      if(e.key==="Enter"||e.key===" "){
        const card = e.target.closest(".request-card"); if(!card) return;
        const idx = +card.dataset.idx; const item = filtered()[idx];
        if(item){ e.preventDefault(); openModal(item); }
      }
    });

    // Submit (preview only)
    $("#request-form").addEventListener("submit",(e)=>{
      e.preventDefault();
      const title=$("#req-title").value.trim(), desc=$("#req-desc").value.trim();
      if(!title||!desc){$("#req-status").textContent="Please fill in the required fields.";return;}
      MOCK.unshift({
        title,
        category:$("#req-category").value,
        priority:$("#req-priority").value,
        desc,
        status:"pending",
        reason:"",
        date:new Date().toISOString().slice(0,10)
      });
      $("#req-status").textContent="âœ… Request submitted (preview).";
      e.target.reset();
      state.page=1;
      renderList();
      renderStatsGrid();
    });

    // Contact (preview only)
    $("#contact-form").addEventListener("submit",(e)=>{
      e.preventDefault();
      const email=$("#contact-email").value.trim(), msg=$("#contact-message").value.trim();
      if(!email||!msg){$("#contact-status").textContent="Please fill in email and message.";return;}
      $("#contact-status").textContent="âœ… Message sent (preview).";
      e.target.reset();
    });

    // Initial render
    renderList();
    renderStatsGrid();
  </script>
</body>
</html>
