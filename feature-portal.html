<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Community Portal ‚Äì Feature Requests</title>
  <link rel="stylesheet" href="portal.css" />
</head>
<body>
  <div id="feature-portal" class="portal-wrapper">
    <!-- Header -->
    <header class="portal-header glass">
      <div class="header-row">
        <h1>üß† Community Portal</h1>
        <a class="home-link" href="/">‚Üê Back to Home</a>
      </div>
      <p>Submit ideas, report bugs, track progress, or contact me directly.</p>
    </header>

    <!-- Tabs -->
    <nav class="portal-tabs glass" aria-label="Sections">
      <button class="tab-btn active" data-tab="submit">üìù Submit</button>
      <button class="tab-btn" data-tab="requests">üìã Requests</button>
      <button class="tab-btn" data-tab="changelog">üßæ Changelog</button>
      <button class="tab-btn" data-tab="stats">üìä Stats</button>
      <button class="tab-btn" data-tab="contact">‚úâÔ∏è Contact</button>
    </nav>

    <!-- SUBMIT -->
    <section id="tab-submit" class="tab-content active glass" role="region" aria-labelledby="submit">
      <h2 id="submit">Submit a Request</h2>
      <form id="request-form" class="portal-form" novalidate>
        <label>
          <span>Title</span>
          <input id="req-title" type="text" placeholder="Summarize your idea‚Ä¶" maxlength="60" required />
          <small class="hint">Max 60 characters</small>
        </label>

        <div class="row-2">
          <label>
            <span>Category</span>
            <select id="req-category">
              <option>Feature</option>
              <option>Bug</option>
              <option>Feedback</option>
            </select>
          </label>
          <label>
            <span>Priority</span>
            <select id="req-priority">
              <option>Normal</option>
              <option>High</option>
              <option>Low</option>
            </select>
          </label>
        </div>

        <label>
          <span>Description</span>
          <textarea id="req-desc" rows="4" placeholder="Explain the idea or issue‚Ä¶" maxlength="500" required></textarea>
          <small class="hint">Max 500 characters</small>
        </label>

        <div class="row-2">
          <label>
            <span>Name (optional)</span>
            <input id="req-name" type="text" placeholder="Your name or handle" maxlength="30" />
          </label>
          <label>
            <span>Email (optional)</span>
            <input id="req-email" type="email" placeholder="you@example.com" />
          </label>
        </div>

        <div class="row-2">
          <label class="checkbox">
            <input id="req-consent" type="checkbox" />
            <span>Allow follow-up if I have questions</span>
          </label>
          <span></span>
        </div>

        <button type="submit" class="onyx-btn">üöÄ Submit</button>
        <p id="req-status" class="req-status" role="status" aria-live="polite"></p>
      </form>
    </section>

    <!-- REQUESTS -->
    <section id="tab-requests" class="tab-content glass" role="region" aria-labelledby="requests">
      <div class="requests-topbar">
        <h2 id="requests">All Requests</h2>

        <!-- Search + Sort -->
        <div class="controls">
          <div class="search-bar glass">
            <svg class="search-icon" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M15.5 14h-.79l-.28-.27a6.47 6.47 0 0 0 1.57-4.23A6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79L20 21.5 21.5 20 15.5 14Zm-6 0A4.5 4.5 0 1 1 14 9.5 4.5 4.5 0 0 1 9.5 14Z"/></svg>
            <input id="search" type="text" placeholder="Search requests‚Ä¶" aria-label="Search requests" />
          </div>

          <label class="sort">
            <span>Sort</span>
            <select id="sort-select" aria-label="Sort requests">
              <option value="newest">Newest</option>
              <option value="oldest">Oldest</option>
              <option value="status">Status</option>
              <option value="category">Category</option>
              <option value="priority">Priority</option>
            </select>
          </label>
        </div>
      </div>

      <!-- Filter chips -->
      <div class="chip-row">
        <div class="chip-group" role="group" aria-label="Category filter">
          <button class="chip active" data-cat="all">All</button>
          <button class="chip" data-cat="Feature">Feature</button>
          <button class="chip" data-cat="Bug">Bug</button>
          <button class="chip" data-cat="Feedback">Feedback</button>
        </div>
        <div class="chip-group" role="group" aria-label="Status filter">
          <button class="chip active" data-status="all">All</button>
          <button class="chip" data-status="pending">Pending</button>
          <button class="chip" data-status="approved">Approved</button>
          <button class="chip" data-status="in_progress">In Progress</button>
          <button class="chip" data-status="completed">Completed</button>
          <button class="chip" data-status="rejected">Rejected</button>
        </div>
      </div>

      <!-- Stats summary -->
      <div class="stats-inline" id="stats-inline">
        <!-- filled by JS -->
      </div>

      <!-- List -->
      <div id="request-list" class="request-list" aria-live="polite">
        <!-- cards injected by JS -->
      </div>

      <!-- Pagination -->
      <div class="pagination">
        <button id="load-more" class="ghost-btn">Load more</button>
      </div>
    </section>

    <!-- CHANGELOG -->
    <section id="tab-changelog" class="tab-content glass" role="region" aria-labelledby="changelog">
      <h2 id="changelog">Changelog</h2>
      <ul class="changelog-list" id="changelog-list">
        <li><strong>Nov 5, 2025:</strong> Advanced Portal preview with filters, sorting, stats, pagination, and contact tab.</li>
        <li><strong>Nov 3, 2025:</strong> Compact mode & layout improvements.</li>
        <li><strong>Oct 30, 2025:</strong> Blur control & reduced motion options.</li>
      </ul>
    </section>

    <!-- STATS -->
    <section id="tab-stats" class="tab-content glass" role="region" aria-labelledby="stats">
      <h2 id="stats">Portal Stats</h2>
      <div class="stats-grid" id="stats-grid">
        <!-- filled by JS -->
      </div>
    </section>

    <!-- CONTACT -->
    <section id="tab-contact" class="tab-content glass" role="region" aria-labelledby="contact">
      <h2 id="contact">Contact</h2>
      <p>Have a question or something private? Send a message here.</p>
      <form id="contact-form" class="portal-form" novalidate>
        <label>
          <span>Name</span>
          <input id="contact-name" type="text" placeholder="Your name" maxlength="40" />
        </label>
        <label>
          <span>Email</span>
          <input id="contact-email" type="email" placeholder="you@example.com" required />
        </label>
        <label>
          <span>Subject</span>
          <select id="contact-subject">
            <option>Support</option>
            <option>Business</option>
            <option>Other</option>
          </select>
        </label>
        <label>
          <span>Message</span>
          <textarea id="contact-message" rows="4" placeholder="Write your message‚Ä¶" maxlength="1000" required></textarea>
        </label>
        <button type="submit" class="onyx-btn">üì® Send</button>
        <p id="contact-status" class="req-status" role="status" aria-live="polite"></p>
      </form>
    </section>
  </div>

  <!-- Request Details Modal -->
  <dialog id="details-modal" class="glass">
    <div class="modal-header">
      <h3 id="modal-title">Request</h3>
      <button id="modal-close" class="icon-btn" aria-label="Close">‚úï</button>
    </div>
    <div id="modal-body" class="modal-body"></div>
    <div class="modal-footer">
      <button id="modal-close-2" class="ghost-btn">Close</button>
    </div>
  </dialog>

  <script>
    /* ===========================
       Mock data (preview only)
       =========================== */
    const MOCK = Array.from([
      {title:"Custom Background Uploads",category:"Feature",priority:"Normal",desc:"Allow users to upload wallpapers.",status:"approved",reason:"",date:"2025-11-02"},
      {title:"Music Visualizer Integration",category:"Feature",priority:"High",desc:"Reactive waveform behind live activity.",status:"in_progress",reason:"",date:"2025-11-01"},
      {title:"Dark Mode Flicker Fix",category:"Bug",priority:"High",desc:"Eliminate flicker toggling themes.",status:"completed",reason:"",date:"2025-10-30"},
      {title:"Auto Play Music on Load",category:"Feature",priority:"Low",desc:"Start playing on page load.",status:"rejected",reason:"Browser autoplay policies.",date:"2025-10-29"},
      {title:"Improve Mobile Spacing",category:"Feedback",priority:"Normal",desc:"Cards are tight on small screens.",status:"pending",reason:"",date:"2025-11-05"},
      {title:"Export Settings JSON",category:"Feature",priority:"Normal",desc:"Download all settings as JSON.",status:"approved",reason:"",date:"2025-10-28"},
      {title:"Search Debounce",category:"Feature",priority:"Low",desc:"Debounce search for performance.",status:"pending",reason:"",date:"2025-11-04"},
      {title:"Contact Auto-Reply",category:"Feature",priority:"Low",desc:"Show confirmation after sending.",status:"completed",reason:"",date:"2025-10-27"},
      {title:"Accessibility Labels",category:"Bug",priority:"High",desc:"Add aria-labels for controls.",status:"approved",reason:"",date:"2025-11-03"},
      {title:"Stats Overview Banner",category:"Feature",priority:"Normal",desc:"Show counts for statuses.",status:"in_progress",reason:"",date:"2025-10-31"},
      {title:"Prevent Duplicate Requests",category:"Feature",priority:"High",desc:"Warn if similar title exists.",status:"pending",reason:"",date:"2025-11-05"}
    ]);

    /* ===========================
       State
       =========================== */
    let state = {
      query: "",
      cat: "all",
      status: "all",
      sort: "newest",
      page: 1,
      pageSize: 6
    };

    /* ===========================
       Helpers
       =========================== */
    const $ = (sel, ctx=document) => ctx.querySelector(sel);
    const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));
    const formatDate = (iso) => new Date(iso+"T00:00:00").toLocaleDateString(undefined,{month:"short",day:"numeric",year:"numeric"});
    const bySort = (a,b) => {
      if (state.sort==="newest") return b.date.localeCompare(a.date);
      if (state.sort==="oldest") return a.date.localeCompare(b.date);
      if (state.sort==="status") return a.status.localeCompare(b.status);
      if (state.sort==="category") return a.category.localeCompare(b.category);
      if (state.sort==="priority") {
        const order = {High:0, Normal:1, Low:2};
        return order[a.priority]-order[b.priority];
      }
      return 0;
    };

    const matchQuery = (r) => {
      if (!state.query) return true;
      const hay = (r.title+" "+r.desc+" "+r.category+" "+r.status+" "+r.priority).toLowerCase();
      return hay.includes(state.query.toLowerCase());
    };
    const matchCat = (r) => state.cat==="all" ? true : r.category===state.cat;
    const matchStatus = (r) => state.status==="all" ? true : r.status===state.status;

    /* ===========================
       Render
       =========================== */
    function computeFiltered() {
      return MOCK.filter(matchQuery).filter(matchCat).filter(matchStatus).sort(bySort);
    }

    function renderStatsInline(list) {
      const total = list.length;
      const count = (s) => list.filter(x=>x.status===s).length;
      $("#stats-inline").innerHTML = `
        <div class="pill">Total: <strong>${total}</strong></div>
        <div class="pill">Approved: <strong>${count("approved")}</strong></div>
        <div class="pill">In Progress: <strong>${count("in_progress")}</strong></div>
        <div class="pill">Completed: <strong>${count("completed")}</strong></div>
        <div class="pill">Rejected: <strong>${count("rejected")}</strong></div>
        <div class="pill">Pending: <strong>${count("pending")}</strong></div>
      `;
    }

    function renderStatsGrid() {
      const list = MOCK;
      const total = list.length;
      const by = (key,val) => list.filter(x=>x[key]===val).length;
      $("#stats-grid").innerHTML = `
        <div class="stat"><h3>${total}</h3><p>Total Requests</p></div>
        <div class="stat"><h3>${by("status","approved")}</h3><p>Approved</p></div>
        <div class="stat"><h3>${by("status","in_progress")}</h3><p>In Progress</p></div>
        <div class="stat"><h3>${by("status","completed")}</h3><p>Completed</p></div>
        <div class="stat"><h3>${by("status","rejected")}</h3><p>Rejected</p></div>
        <div class="stat"><h3>${by("status","pending")}</h3><p>Pending</p></div>
      `;
    }

    function statusLabel(s) {
      return {
        approved: "‚úÖ Approved",
        in_progress: "‚öôÔ∏è In Progress",
        completed: "‚úÖ Completed",
        rejected: "‚ùå Rejected",
        pending: "‚Ä¢ Pending"
      }[s] || s;
    }

    function cardHTML(r, idx) {
      const cls = `request-card ${r.status==="rejected"?"rejected":""}`;
      const st = `status ${r.status.replace("_","-")}`;
      const reason = r.reason ? `<small class="reason">Reason: ${r.reason}</small>` : "";
      return `
        <article class="${cls}" data-idx="${idx}" tabindex="0" role="button" aria-label="Open request details: ${r.title}">
          <h3>${r.title}</h3>
          <p>${r.desc}</p>
          <div class="meta">
            <span class="badge">${r.category}</span>
            <span class="badge ${r.priority.toLowerCase()}">${r.priority}</span>
            <span class="${st}">${statusLabel(r.status)}</span>
            <span class="date">Submitted: ${formatDate(r.date)}</span>
          </div>
          ${reason}
        </article>
      `;
    }

    function renderList() {
      const all = computeFiltered();
      renderStatsInline(all);

      const start = 0;
      const end = state.page * state.pageSize;
      const pageItems = all.slice(start, end);

      $("#request-list").innerHTML = pageItems.map((r,i)=>cardHTML(r,i)).join("") || `<p class="muted">No matching requests.</p>`;
      $("#load-more").style.display = end < all.length ? "inline-flex" : "none";
    }

    /* ===========================
       Modal
       =========================== */
    const modal = $("#details-modal");
    const openModal = (r) => {
      $("#modal-title").textContent = r.title;
      $("#modal-body").innerHTML = `
        <div class="kv"><span>Category</span><strong>${r.category}</strong></div>
        <div class="kv"><span>Priority</span><strong>${r.priority}</strong></div>
        <div class="kv"><span>Status</span><strong>${statusLabel(r.status)}</strong></div>
        <div class="kv"><span>Date</span><strong>${formatDate(r.date)}</strong></div>
        <p class="mt">${r.desc}</p>
        ${r.reason ? `<p class="muted">Reject reason: ${r.reason}</p>` : ""}
      `;
      modal.showModal();
    };
    modal.addEventListener("click", (e) => {
      const rect = modal.getBoundingClientRect();
      if (e.clientX < rect.left || e.clientX > rect.right || e.clientY < rect.top || e.clientY > rect.bottom) modal.close();
    });
    $("#modal-close").onclick = $("#modal-close-2").onclick = ()=>modal.close();

    /* ===========================
       Wire up interactions
       =========================== */
    // tabs
    $$(".tab-btn").forEach(btn=>{
      btn.addEventListener("click",()=>{
        $$(".tab-btn").forEach(b=>b.classList.remove("active"));
        $$(".tab-content").forEach(c=>c.classList.remove("active"));
        btn.classList.add("active");
        $("#tab-"+btn.dataset.tab).classList.add("active");
        window.scrollTo({top:0,behavior:"smooth"});
      });
    });

    // search
    $("#search").addEventListener("input",(e)=>{ state.query = e.target.value.trim(); state.page=1; renderList(); });

    // sort
    $("#sort-select").addEventListener("change",(e)=>{ state.sort = e.target.value; state.page=1; renderList(); });

    // category chips
    $$("[data-cat]").forEach(ch=>{
      ch.addEventListener("click",()=>{
        $$("[data-cat]").forEach(c=>c.classList.remove("active"));
        ch.classList.add("active");
        state.cat = ch.dataset.cat;
        state.page=1;
        renderList();
      });
    });

    // status chips
    $$("[data-status]").forEach(ch=>{
      ch.addEventListener("click",()=>{
        $$("[data-status]").forEach(c=>c.classList.remove("active"));
        ch.classList.add("active");
        state.status = ch.dataset.status;
        state.page=1;
        renderList();
      });
    });

    // pagination
    $("#load-more").addEventListener("click",()=>{ state.page++; renderList(); });

    // list click -> modal
    $("#request-list").addEventListener("click",(e)=>{
      const card = e.target.closest(".request-card");
      if (!card) return;
      const idx = +card.dataset.idx;
      const item = computeFiltered()[idx];
      if (item) openModal(item);
    });
    $("#request-list").addEventListener("keydown",(e)=>{
      if (e.key==="Enter" || e.key===" ") {
        const card = e.target.closest(".request-card");
        if (!card) return;
        const idx = +card.dataset.idx;
        const item = computeFiltered()[idx];
        if (item) { e.preventDefault(); openModal(item); }
      }
    });

    // submit (preview only)
    $("#request-form").addEventListener("submit",(e)=>{
      e.preventDefault();
      const title = $("#req-title").value.trim();
      const desc = $("#req-desc").value.trim();
      if (!title || !desc) { $("#req-status").textContent = "Please fill in the required fields."; return; }
      const doc = {
        title,
        category: $("#req-category").value,
        priority: $("#req-priority").value,
        desc,
        status: "pending",
        reason: "",
        date: new Date().toISOString().slice(0,10)
      };
      MOCK.unshift(doc);
      $("#req-status").textContent = "‚úÖ Request submitted (preview).";
      e.target.reset();
      state.page=1;
      renderList();
      renderStatsGrid();
    });

    // contact (preview only)
    $("#contact-form").addEventListener("submit",(e)=>{
      e.preventDefault();
      const email = $("#contact-email").value.trim();
      const msg = $("#contact-message").value.trim();
      if (!email || !msg) { $("#contact-status").textContent = "Please fill in email and message."; return; }
      $("#contact-status").textContent = "‚úÖ Message sent (preview).";
      e.target.reset();
    });

    // initial render
    renderList();
    renderStatsGrid();
  </script>
</body>
</html>
